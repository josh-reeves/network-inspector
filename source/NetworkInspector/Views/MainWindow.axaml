<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:models="using:NetworkInspector.Models"
        xmlns:viewModels="using:NetworkInspector.ViewModels"
        xmlns:converters="using:NetworkInspector.Converters"
        mc:Ignorable="d" d:DesignWidth="640" d:DesignHeight="480"
        x:Class="NetworkInspector.Views.MainWindow"
        x:DataType="viewModels:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="NetworkInspector"
        Width="640"
        Height="480">

    <!-- This only sets the DataContext for the previewer in an IDE, to set the actual DataContext for runtime, set the DataContext property in code 
         (look at App.axaml.cs) -->
    <Design.DataContext>
        <viewModels:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Resources>
        <converters:IPAddressConverter x:Key="IPAddressConverter" />
        <converters:ListConverter x:Key ="ListConverter" />
    </Window.Resources>

    <DockPanel >

        <WrapPanel Margin="10"
                   HorizontalAlignment="Center"
                   DockPanel.Dock="Top">

                <StackPanel Orientation="Vertical"
                            Margin="10"
                            Spacing="10">

                    <TextBlock Text="Start IP Address:" 
                               HorizontalAlignment="Left"/>

                    <TextBox Width="200" 
                             HorizontalAlignment="Left"
                             Text="{Binding FirstAddress, Converter={StaticResource IPAddressConverter}}"/>

                </StackPanel>

                <StackPanel Orientation="Vertical"
                            Margin="10"
                            Spacing="10">

                    <TextBlock Text="End IP Address:" 
                               HorizontalAlignment="Left"/>

                    <StackPanel Orientation="Horizontal"
                                Spacing="10">

                        <TextBox Width="200"
                                 Text="{Binding LastAddress, Converter={StaticResource IPAddressConverter}}"/>

                        <ComboBox ItemsSource="{Binding CIDRMasks}"
                                  SelectedItem="{Binding Subnet}"/>

                    </StackPanel>

                </StackPanel>

                <StackPanel Orientation="Vertical"
                            Margin="10"
                            Spacing="10">

                    <TextBlock Text="Ports:"/>

                    <TextBox Width="200" 
                             Text="{Binding Ports, Converter={StaticResource ListConverter}, ConverterParameter=', '}"
                             HorizontalAlignment="Left"/>

                </StackPanel>

        </WrapPanel>

        <StackPanel Orientation="Vertical"
                    DockPanel.Dock="Bottom">

            <DataGrid Margin="10" 
                      Height="245"
                      BorderThickness="1" 
                      ItemsSource="{Binding ScannedHosts}" 
                      GridLinesVisibility="All" 
                      CanUserResizeColumns="True"
                      IsReadOnly="True"
                      BorderBrush="DarkGray">
                <DataGrid.Columns>
                    <DataGridTextColumn Width="*" 
                                        Header="Address"
                                        Binding="{Binding Address}" />
                    <DataGridTextColumn Width="*" 
                                        Header="Status" 
                                        Binding="{Binding Status}" />
                    <DataGridTemplateColumn Width="*"
                                            Header="Open Ports">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ItemsControl VerticalAlignment="Center"
                                              Margin="10"
                                              ItemsSource="{Binding OpenPorts}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="models:HostAddress">
                                            <TextBlock Text="{Binding .}" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <Button Height="30"
                    Width="75"
                    CornerRadius="5"
                    HorizontalAlignment="Center"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center"
                    Command="{Binding StartScan}">
                        <TextBlock Text="Scan" />
            </Button>

        </StackPanel>

    </DockPanel> 

</Window>
